{% extends 'base.html' %}

{% block title %}Dashboard - Gerente Financeiro{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <div>
        <h1 class="text-xl font-bold">üè† Dashboard</h1>
        
        {# ADI√á√ÉO: Exibe o per√≠odo din√¢mico que calculamos na view #}
        {% if periodo_inicio and periodo_fim %}
            <p class="text-sm text-secondary">
                Exibindo dados de <strong>{{ periodo_inicio|date:"d/m/Y" }}</strong> at√© <strong>{{ periodo_fim|date:"d/m/Y" }}</strong>
            </p>
        {% endif %}
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
    <div class="card">
        <div class="card-body text-center">
            {# Usar floatformat √© um pouco mais robusto para valores monet√°rios #}
            <div class="text-2xl font-bold text-success">R$ {{ total_entradas|floatformat:2 }}</div>
            
            {# ALTERA√á√ÉO: R√≥tulo ajustado para refletir o per√≠odo #}
            <div class="text-sm text-secondary">Total Entradas (Per√≠odo)</div>
        </div>
    </div>
    <div class="card">
        <div class="card-body text-center">
            <div class="text-2xl font-bold text-danger">R$ {{ total_saidas|floatformat:2 }}</div>
            
            {# ALTERA√á√ÉO: R√≥tulo ajustado para refletir o per√≠odo #}
            <div class="text-sm text-secondary">Total Sa√≠das (Per√≠odo)</div>
        </div>
    </div>
    <div class="card">
        <div class="card-body text-center">
            <div class="text-2xl font-bold">R$ {{ saldo_total|floatformat:2 }}</div>
            
            {# ALTERA√á√ÉO: R√≥tulo ajustado para refletir o per√≠odo #}
            <div class="text-sm text-secondary">Saldo do Per√≠odo</div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">√öltimos Lan√ßamentos</h2>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Descri√ß√£o</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lancamento in ultimos_lancamentos %}
                    <tr>
                        <td>{{ lancamento.data|date:"d/m/Y" }}</td>
                        <td>{{ lancamento.descricao }}</td>
                        <td class="font-semibold {% if lancamento.tipo == 'entrada' %}text-success{% else %}text-danger{% endif %}">
                            {% if lancamento.tipo == 'entrada' %}+{% else %}-{% endif %}R$ {{ lancamento.valor|floatformat:2 }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="text-center text-secondary">
                            Nenhum lan√ßamento recente.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="card-body text-right">
            <a href="{% url 'lista_lancamentos' %}" class="btn btn-outline btn-sm">
                Ver todos os lan√ßamentos ‚Üí
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Cofrinhos em Andamento</h2>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Saldo</th>
                        <th>Meta</th>
                        <th>Progresso</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cofrinho in cofrinhos %}
                    <tr>
                        <td>{{ cofrinho.nome }}</td>
                        <td>R$ {{ cofrinho.saldo|floatformat:2 }}</td>
                        <td>R$ {{ cofrinho.meta|floatformat:2 }}</td>
                        <td>
                             {% if cofrinho.meta > 0 %}
                                <div class="progress-bar">
                                    <div class="progress" style="width: {{ cofrinho.progresso }}%;"></div>
                                    <span class="progress-text">{{ cofrinho.progresso|floatformat:0 }}%</span>
                                </div>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-secondary">
                            Nenhum cofrinho em andamento.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="card-body text-right">
            <a href="{% url 'lista_cofrinhos' %}" class="btn btn-outline btn-sm">
                Ver todos os cofrinhos ‚Üí
            </a>
        </div>
    </div>
</div>

{# A se√ß√£o de cart√µes de cr√©dito n√£o precisa de altera√ß√£o, pois j√° mostra dados pr√≥prios #}
<div class="card mt-6">
    <div class="card-header">
        <h2 class="card-title">üí≥ Cart√µes de Cr√©dito</h2>
    </div>
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Limite Total</th>
                    <th>Limite Dispon√≠vel</th>
                    <th>% Usado</th>
                    <th>Gasto M√™s Atual</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for cartao in cartoes_credito %}
                <tr>
                    <td>{{ cartao.nome }}</td>
                    <td>R$ {{ cartao.limite_total|floatformat:2 }}</td>
                    <td>R$ {{ cartao.limite_disponivel|floatformat:2 }}</td>
                    <td>{{ cartao.percentual_usado_valor|floatformat:0 }}%</td>
                    <td>R$ {{ cartao.gasto_mes_atual|floatformat:2 }}</td>
                    <td>
                        <a href="{% url 'detalhes_cartao' pk=cartao.pk %}" class="btn btn-info btn-sm">Detalhes</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center text-secondary">
                        Nenhum cart√£o de cr√©dito cadastrado.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="card-body text-right">
        <a href="{% url 'lista_cartoes' %}" class="btn btn-outline btn-sm">
            Gerenciar Cart√µes ‚Üí
        </a>
    </div>
</div>
{% endblock %}
