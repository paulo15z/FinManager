{% extends 'base.html' %}

{% block title %}Editar Lan√ßamento - Gerente Financeiro{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">‚úèÔ∏è Editar Lan√ßamento</h2>
    </div>
    <div class="card-body">
        <form method="post" class="form-container">
            {% csrf_token %}
            
            {% for field in form %}
            <div class="form-group" id="div_{{ field.auto_id }}">
                <label for="{{ field.id_for_label }}" class="form-label">
                    {{ field.label }}
                </label>
                {{ field }}
                {% if field.errors %}
                    <div class="text-danger text-sm mt-1">
                        {{ field.errors.0 }}
                    </div>
                {% endif %}
            </div>
            {% endfor %}
            
            <div class="form-actions">
                <a href="{% url 'lista_lancamentos' %}" class="btn btn-outline">
                    Cancelar
                </a>
                <button type="submit" class="btn btn-warning">
                    üíæ Atualizar Lan√ßamento
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 1. Encontra os campos de controle e o campo a ser controlado
    const tipoField = document.getElementById('id_tipo');
    const metodoPagamentoField = document.getElementById('id_metodo_pagamento');
    const cartaoCreditoContainer = document.getElementById('div_id_cartao_credito');

    // 2. Fun√ß√£o que cont√©m a l√≥gica para mostrar ou esconder o campo
    function toggleCartaoCreditoField() {
        // Pega os valores atuais dos campos de controle
        const tipoSelecionado = tipoField.value;
        const metodoSelecionado = metodoPagamentoField.value;

        // A condi√ß√£o principal: S√ì mostra se for SA√çDA E CART√ÉO DE CR√âDITO
        if (tipoSelecionado === 'saida' && metodoSelecionado === 'cartao_credito') {
            if (cartaoCreditoContainer) {
                cartaoCreditoContainer.style.display = 'block'; // Mostra o campo
            }
        } else {
            if (cartaoCreditoContainer) {
                cartaoCreditoContainer.style.display = 'none'; // Esconde o campo
                // Opcional: Limpa o valor do cart√£o se ele for escondido, para evitar envios acidentais
                const cartaoSelect = document.getElementById('id_cartao_credito');
                if (cartaoSelect) {
                    cartaoSelect.value = '';
                }
            }
        }
    }

    // 3. Adiciona "escutadores" de eventos para os campos de controle
    if (tipoField) {
        tipoField.addEventListener('change', toggleCartaoCreditoField);
    }
    if (metodoPagamentoField) {
        metodoPagamentoField.addEventListener('change', toggleCartaoCreditoField);
    }

    // 4. Executa a fun√ß√£o uma vez no carregamento da p√°gina para definir o estado inicial correto
    toggleCartaoCreditoField();
});
</script>
{% endblock %}
